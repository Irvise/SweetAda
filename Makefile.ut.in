
#
# Utilities sub-Makefile
#
# Copyright (C) 2020-2023 Gabriele Galeotti
#
# This work is licensed under the terms of the MIT License.
# Please consult the LICENSE.txt file located in the top-level directory.
#

#
# Environment variables:
# OSTYPE
# EXEEXT
# SCREXT
# SCREXT_cmd
# SCREXT_unx
# LIBUTILS_DIRECTORY
#

ifeq      ($(OSTYPE),msys)
ELFTOOL      := elftool-win$(EXEEXT)
GCC_WRAPPER  := gcc-wrapper-win$(EXEEXT)
GNAT_WRAPPER := gnat-wrapper-win$(EXEEXT)
else ifeq ($(OSTYPE),cmd)
ELFTOOL      := elftool-win$(EXEEXT)
GCC_WRAPPER  := gcc-wrapper-win$(EXEEXT)
GNAT_WRAPPER := gnat-wrapper-win$(EXEEXT)
else ifeq ($(OSTYPE),darwin)
ELFTOOL      := elftool-osx$(EXEEXT)
GCC_WRAPPER  := gcc-wrapper-osx$(EXEEXT)
GNAT_WRAPPER := gnat-wrapper-osx$(EXEEXT)
else ifeq ($(OSTYPE),linux)
ELFTOOL      := elftool-lnx$(EXEEXT)
GCC_WRAPPER  := gcc-wrapper-lnx$(EXEEXT)
GNAT_WRAPPER := gnat-wrapper-lnx$(EXEEXT)
else
$(error Error: no valid executables for OSTYPE '$(OSTYPE)')
endif

ifeq ($(OSTYPE),msys)
CREATECONFIGUREGPR := createconfiguregpr$(SCREXT_cmd)
CREATEDEFINITIONS  := createdefinitions$(SCREXT_cmd)
CREATEGNATADC      := creategnatadc$(SCREXT_cmd)
CREATESYMLINK      := createsymlink$(SCREXT_cmd)
DOS2UNIX           := dos2unix$(SCREXT_cmd)
FILEPAD            := filepad$(SCREXT_cmd)
FILEPATCH          := filepatch$(SCREXT_cmd)
GPRDEPS            := powershell -ExecutionPolicy Bypass -File $(LIBUTILS_DIRECTORY)/gprdeps.ps1
PROCESSCFG         := processcfg$(SCREXT_cmd)
UPDATETM           := updatetm$(SCREXT_cmd)
else
CREATECONFIGUREGPR := createconfiguregpr$(SCREXT)
CREATEDEFINITIONS  := createdefinitions$(SCREXT)
CREATEGNATADC      := creategnatadc$(SCREXT)
CREATESYMLINK      := createsymlink$(SCREXT)
ifeq ($(OSTYPE),cmd)
DOS2UNIX           := dos2unix$(SCREXT)
GPRDEPS            := powershell -ExecutionPolicy Bypass -File $(LIBUTILS_DIRECTORY)/gprdeps.ps1
UPDATETM           := updatetm$(SCREXT)
else
DOS2UNIX           :=
GPRDEPS            := gprdeps$(SCREXT)
UPDATETM           :=
endif
FILEPAD            := filepad$(SCREXT)
FILEPATCH          := filepatch$(SCREXT)
GPRDEPS            := gprdeps$(SCREXT)
PROCESSCFG         := processcfg$(SCREXT)
endif

# needed by RTS Makefile
export PROCESSCFG
# utilities useful in user scripts
export FILEPAD FILEPATCH
# needed by Makefile.lb.in
export UPDATETM
# needed by GPRbuild
export GCC_WRAPPER
# useful utility
export DOS2UNIX

